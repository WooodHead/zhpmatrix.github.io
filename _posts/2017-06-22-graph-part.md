---
layout: post
title: "[ML&DL]用图分割的方式加速随机粒子群优化算法(RDPSO)"
excerpt: "嗯，这个事情应该没有人做过滴，因为老板是RDPSO主要发明人呀。本文简要谈RDPSO的加速计算，主要涉及MPI的通信函数梳理和一些基本且重要的概念。"
date: 2017-06-22 21:30:00
mathjax: true
---
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>

在[基于图的目标函数分解策略](https://zhpmatrix.github.io/2017/06/14/graph-partitioning/)中，已经相对详细的说了目标函数分解的方法，本文则谈**计算**的问题。

#### 0. 同步，异步，阻塞，非阻塞

**同步**是指**调用者**没有从**被调用者**那里得到**结果**前，调用者不返回。

**异步**是指调用者发出调用后就返回(没有结果)，当有结果时，被调用者告诉调用者。

**阻塞**是在**没有获得结果前**，调用者一直等待，啥也不干。

**非阻塞**是在**没有获得结果前**，调用者去干别的事情，时不时查询一下被调用者是否返回结果。

[一个字一个字儿读]

从上述关系上来看，同步和异步反映调用者和被调用者之间的关系，或者说反映了二者之间的**消息通信机制**，阻塞和非阻塞描述的是调用者的状态，**异步一定是非阻塞**，但是调用者获取结果的方式不同，对异步来说，是调用者被动接受(由被调用者发出"有结果啦"的消息)，而非阻塞是调用者主动获取(时不时问被调用者，"有结果没呢?")。但是**同步是可以分为阻塞和非阻塞**的，注意同步和非阻塞的关系，调用者不返回和调用者去干别的事情不冲突的。

关于上述概念更丰富的理解，可以见[这里](https://www.zhihu.com/question/19732473)。


#### 1. MPI通信

1.1 MPI_Send和MPI_Recv，MPI_ISend和MPI_IRecv

1.2 集合通信

集合操作的三种类型包括：同步，数据传递(广播，分散，收集等)，规约。具体可以参照这篇[文章](http://blog.csdn.net/miaohongyu1/article/details/21093913)，想来与神威太湖之光也就一墙之隔。

#### 2. 计算实现

下图是目标函数分解后的通信拓扑：

![cluster](http://wx3.sinaimg.cn/mw690/aba7d18bgy1fgu9z90slnj20e00d8gml.jpg)

Rosenbrock's function如下：

$$
   F=\sum_{i=1}^{D-1}(100(x_{i}^2-x_{i+1})^2+(x_{i}-1)^2)+bias
$$

令D=6(变量维度)，K=3(子目标个数)，由于是按照SUM方式分解，每个子目标的和就是原目标。如上图，红色圆圈表示子目标f1，绿色表示子目标f2，紫色表示子目标f3，由分解结果知道，f1和f2的依赖变量是x1，f2和f3的依赖变量是x3。如何利用[RDPSO算法](https://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-15-S6-S1)寻找原函数的最小值？据老板说，他搞的这个算法在**稳定性**上比较好，具体没有研究过。

整体的思路是：给集群的每个计算节点上分配一个粒子群用来优化对应的子函数f，设置子种群迭代次数sub_iter，**当子种群迭代次数到达该值时（目前假定f1,f2,f3同时到达），f1和f2交换x1的值，f2和f3交换x3的值，交换后的值作为下一次迭代的粒子初始值，相比于首次迭代开始，粒子初始值是随机值。**设置种群迭代次数max_iter，也就是子种群互相交互的次数，当达到该值时，在管理节点上得到每个子种群的粒子位置gbestx和对应的最优值gbest，所有子种群的gbest求和作为全局gbest。

实际上在上述策略中，涉及的关键问题是**冲突变量的解决**。围绕着交换冲突(共享)变量的目标，要解决两个问题，**第一是when?**在假设子目标寻优同时结束的情况下，策略如上描述，这是一种同步方案。可是假设子目标函数的差别较大，子目标寻优不同时结束时情况怎样？其中一种情况是f2和f1以及f3都有x1的依赖，如何处理关于x1的更新呢？显然此时需要为x1加锁，但是会不会由于同步方案的选择造成计算效率的降低？**第二是how?**在上述策略描述中，简单的做exchange，如何评估方案的好坏？比如说更好的加权方案，满足某种映射关系？

代码还没有整理，雏形阶段，不是对这个问题感兴趣，一定不要点开。[Github代码](https://github.com/zhpmatrix/metis)





















